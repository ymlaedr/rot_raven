version: "3"
services:
  backend:
    build:
      context: ./docker/backend
      dockerfile: Dockerfile
    ports:
      - "4000:4000"
    volumes:
      - "./docker/backend/housebook:/root/housebook"
    command: ["mix", "phx.server"]
    depends_on:
      - database

  database:
    image: postgres:11-alpine
    ports:
      - "5432:5432"
    volumes:
      - postgresql-data:/var/lib/postgresql
    environment:
      - "TZ=Asia/Tokyo"
      - "POSTGRES_INITDB_ARGS='--lc-collate=ja_JP.utf8' '--lc-ctype=ja_JP.utf8'"
      - "POSTGRES_USER=postgres"
      - "POSTGRES_PASSWORD=postgres"
      - "POSTGRES_HOST=database"

  gigalixir_client:
    build:
      context: ./docker/gigalixir_client
      dockerfile: Dockerfile
    env_file:
      - env_files/gigalixir_login.env

volumes:
  postgresql-data:
    driver: local
